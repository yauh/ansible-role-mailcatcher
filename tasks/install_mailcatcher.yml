- name: Install mailcatcher dependencies
  apt: pkg={{ item }} state=present
  with_items:
      - build-essential
      - sqlite3
      - libsqlite3-dev
      - ruby-dev
      - ruby

- name: Check for mailcatcher
  stat:
    path=/usr/local/bin/mailcatcher
  register: mailcatcher_installed

- name: Install required mime-types
  command: gem install mime-types --version "< 3"

- name: Install Mailcatcher
<<<<<<< HEAD
  command: gem install mailcatcher -v 0.5.12
=======
  command: gem install mailcatcher:0.5.12
>>>>>>> b031846... Specify the old mailcatcher version
  when: not mailcatcher_installed.stat.exists

- name: Create upstart script for mailcatcher
  template: src=mailcatcher.j2 dest=/etc/init/mailcatcher.conf mode=0644
  notify:
    - restart mailcatcher
